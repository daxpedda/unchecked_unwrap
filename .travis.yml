language: rust
rust:
- stable
- beta
- nightly
os:
- linux
cache: cargo
env:
  global:
  - RUST_BACKTRACE=1
script:
- cargo build
- cargo test
- cargo doc
- if [ "$TRAVIS_RUST_VERSION" == "nightly" ]; then cargo bench; fi
matrix:
  include:
  - os: linux
    rust: nightly
    sudo: required
    cache:
      cargo: true
      directories:
      - target/kcov-master/build
    addons:
      apt:
        packages:
        - libcurl4-openssl-dev
        - libelf-dev
        - libdw-dev
        - binutils-dev
        - cmake
    before_install:
    - openssl aes-256-cbc -K $encrypted_ea461eafb522_key -iv $encrypted_ea461eafb522_iv -in ".travis/github_deploy_key.enc" -out ".travis/github_deploy_key" -d
    - chmod 600 ".travis/github_deploy_key"
    - eval "$(ssh-agent -s)"
    - sshpass -p "" ssh-add ".travis/github_deploy_key"
    script:
    - cargo build
    - cargo test
    - cargo doc
    - cargo bench
    - cargo install cargo-update || echo "cargo-update already installed"
    - cargo install cargo-travis || echo "cargo-travis already installed"
    - cargo install-update -a
    - cargo coverage
    - bash <(curl -s https://codecov.io/bash) -s target/kcov
    - cargo doc-upload
  exclude:
  - os: linux
    rust: nightly
